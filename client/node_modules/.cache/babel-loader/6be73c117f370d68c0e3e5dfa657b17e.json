{"ast":null,"code":"import _objectSpread from \"/Users/almabraun/Event-Scheduler/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/almabraun/Event-Scheduler/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/almabraun/Event-Scheduler/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/almabraun/Event-Scheduler/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/almabraun/Event-Scheduler/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/almabraun/Event-Scheduler/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/almabraun/Event-Scheduler/client/src/components/Schedule/index.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport PropTypes from \"prop-types\";\nimport { toast } from \"react-toastify\";\nimport Timeline from \"./Timeline.js\";\nimport EventsGroup from \"./EventsGroup.js\";\nimport EventModal from \"./EventModal.js\";\nimport Fab from \"@material-ui/core/Fab\";\nimport AddIcon from \"@material-ui/icons/Add\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\nimport { withStyles } from \"@material-ui/core/styles\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport { logUserOut } from \"../../actions/userActions.js\";\nimport { loadUserEvents, clearError } from \"../../actions/eventActions.js\";\nimport { TIMELINE_UNIT_DURATION, EVENT_SLOT_HEIGHT, DEFAULT_TO, DEFAULT_FROM, WEEK_DAYS, AUTH_ERRORS, EVENT_ERRORS } from \"../../constants\";\nimport \"../../styles/Schedule.css\"; // styled material ui tooltip and fab\n\nvar StyledTooltip = withStyles({\n  tooltip: {\n    fontSize: 13\n  }\n})(Tooltip);\nvar StyledFab = withStyles({\n  root: {\n    position: \"fixed\",\n    right: \"40px\",\n    bottom: \"35px\",\n    zIndex: 2,\n    width: \"70px\",\n    height: \"70px\"\n  }\n})(Fab);\n\nvar Schedule =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Schedule, _Component);\n\n  function Schedule(props) {\n    var _this;\n\n    _classCallCheck(this, Schedule);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Schedule).call(this, props));\n\n    _this.openModalWithEvent = function (event) {\n      return function (e) {\n        e.preventDefault();\n\n        _this.setState({\n          isModalOpen: true,\n          isEditMode: false,\n          eventToShowInModal: event\n        });\n      };\n    };\n\n    _this.setIsEditMode = function () {\n      var isEditMode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n      _this.setState({\n        isEditMode: isEditMode\n      });\n    };\n\n    _this.closeModal = function (event) {\n      if (event) event.preventDefault();\n\n      _this.setState({\n        isModalOpen: false\n      });\n    };\n\n    _this.addButtonClickHandler = function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      _this.setState({\n        isModalOpen: true,\n        isEditMode: true,\n        eventToShowInModal: null\n      });\n    };\n\n    _this.organizeEventsByWeekday = function (events) {\n      var timelineFrom = DEFAULT_FROM,\n          timelineTo = DEFAULT_TO;\n      var eventsByWeekday = [];\n\n      for (var i = 0; i < WEEK_DAYS.length; i++) {\n        eventsByWeekday[i] = [];\n      }\n\n      if (Array.isArray(events)) {\n        // sort events by event's startAt\n        events.sort(function (e1, e2) {\n          return e1.startAt - e2.startAt;\n        }); // loop through events\n\n        for (var _i = 0; _i < events.length; _i++) {\n          var event = events[_i];\n          var weekday = event.weekday,\n              startAt = event.startAt,\n              endAt = event.endAt; // update timeline from\n\n          if (startAt < timelineFrom) timelineFrom = startAt <= 0 ? 0 : Math.floor(startAt / TIMELINE_UNIT_DURATION) * TIMELINE_UNIT_DURATION; // update timeline to\n\n          if (endAt > timelineTo) timelineTo = endAt >= 1440 ? 1440 : Math.ceil(endAt / TIMELINE_UNIT_DURATION) * TIMELINE_UNIT_DURATION; // push event to corresponding weekday events array\n\n          eventsByWeekday[weekday].push(event);\n        }\n      } // compute EventsGroup's events <ul> css height\n\n\n      var eventsGroupUlHeight = Math.ceil((timelineTo - timelineFrom) / TIMELINE_UNIT_DURATION) * EVENT_SLOT_HEIGHT;\n      return {\n        eventsByWeekday: eventsByWeekday,\n        timelineFrom: timelineFrom,\n        timelineTo: timelineTo,\n        eventsGroupUlHeight: eventsGroupUlHeight\n      };\n    };\n\n    _this.state = _objectSpread({\n      isModalOpen: false,\n      isEditMode: false,\n      eventToShowInModal: null\n    }, _this.organizeEventsByWeekday(props.events));\n    return _this;\n  }\n\n  _createClass(Schedule, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (prevProps.events !== this.props.events) {\n        // if events array changed, reorganize and set state\n        this.setState(this.organizeEventsByWeekday(this.props.events));\n      }\n\n      if (this.props.error) {\n        console.log(this.props.error);\n        var error = this.props.error;\n\n        if (error.code) {\n          // handle http error response\n          var errorName = error.name;\n\n          if (AUTH_ERRORS[errorName]) {\n            var msg = \"ðŸ˜… Token expired, pls sign in again\"; // jwt token lost, expired or invalid\n\n            if (errorName === AUTH_ERRORS.DeletedUser) {\n              // user is deleted\n              msg = \"ðŸ˜… Account deleted, pls sign up\";\n            }\n\n            toast.warn(msg); // sign out user\n\n            this.props.logUserOut();\n          } else if (EVENT_ERRORS[errorName]) {\n            // event does not exist\n            toast.warn(\"ðŸ˜… Event not found, reloading events\"); // reload user events\n\n            this.props.loadUserEvents();\n          }\n        } // clear error\n\n\n        this.props.clearError();\n      }\n    } // return a click handler which bind a specific event for <SingleEvent />\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var isLoadingUserEvents = this.props.isLoadingUserEvents;\n      var _this$state = this.state,\n          isEditMode = _this$state.isEditMode,\n          isModalOpen = _this$state.isModalOpen,\n          eventToShowInModal = _this$state.eventToShowInModal,\n          eventsByWeekday = _this$state.eventsByWeekday,\n          timelineFrom = _this$state.timelineFrom,\n          timelineTo = _this$state.timelineTo,\n          eventsGroupUlHeight = _this$state.eventsGroupUlHeight;\n      return React.createElement(\"div\", {\n        className: \"cd-schedule\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      },\n      /* Loading spinner, conditional render */\n      isLoadingUserEvents && React.createElement(\"div\", {\n        className: \"progress-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, React.createElement(CircularProgress, {\n        color: \"secondary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, \"Loading events...\")), React.createElement(Timeline, {\n        from: timelineFrom,\n        to: timelineTo,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"events\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, React.createElement(\"ul\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }, WEEK_DAYS.map(function (WEEK_DAY, i) {\n        return React.createElement(EventsGroup, {\n          key: i,\n          weekday: WEEK_DAY,\n          events: eventsByWeekday[i],\n          timelineFrom: timelineFrom,\n          ulCSSHeight: eventsGroupUlHeight,\n          openModalWithEvent: _this2.openModalWithEvent,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 201\n          },\n          __self: this\n        });\n      }))),\n      /* Add event button, conditional render */\n      !isLoadingUserEvents && React.createElement(StyledTooltip, {\n        title: \"Add Event\",\n        placement: \"top\",\n        \"aria-label\": \"Add Event\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214\n        },\n        __self: this\n      }, React.createElement(StyledFab, {\n        color: \"secondary\",\n        \"aria-label\": \"Add\",\n        onClick: this.addButtonClickHandler,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219\n        },\n        __self: this\n      }, React.createElement(AddIcon, {\n        style: {\n          width: \"30px\",\n          height: \"30px\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }))), React.createElement(EventModal, {\n        closeModal: this.closeModal,\n        isEditMode: isEditMode,\n        isModalOpen: isModalOpen,\n        eventToShow: eventToShowInModal,\n        setIsEditMode: this.setIsEditMode,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Schedule;\n}(Component);\n\nSchedule.propTypes = {\n  error: PropTypes.object,\n  events: PropTypes.array.isRequired,\n  logUserOut: PropTypes.func.isRequired,\n  clearError: PropTypes.func.isRequired,\n  loadUserEvents: PropTypes.func.isRequired,\n  isUserLoggedIn: PropTypes.bool.isRequired,\n  isLoadingUserEvents: PropTypes.bool.isRequired\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    isUserLoggedIn: state.User.isUserLoggedIn,\n    isLoadingUserEvents: state.Event.isLoadingUserEvents,\n    events: state.Event.events,\n    error: state.Event.error\n  };\n};\n\nexport default connect(mapStateToProps, {\n  logUserOut: logUserOut,\n  loadUserEvents: loadUserEvents,\n  clearError: clearError\n})(Schedule);","map":{"version":3,"sources":["/Users/almabraun/Event-Scheduler/client/src/components/Schedule/index.js"],"names":["React","Component","connect","PropTypes","toast","Timeline","EventsGroup","EventModal","Fab","AddIcon","Tooltip","withStyles","CircularProgress","logUserOut","loadUserEvents","clearError","TIMELINE_UNIT_DURATION","EVENT_SLOT_HEIGHT","DEFAULT_TO","DEFAULT_FROM","WEEK_DAYS","AUTH_ERRORS","EVENT_ERRORS","StyledTooltip","tooltip","fontSize","StyledFab","root","position","right","bottom","zIndex","width","height","Schedule","props","openModalWithEvent","event","e","preventDefault","setState","isModalOpen","isEditMode","eventToShowInModal","setIsEditMode","closeModal","addButtonClickHandler","stopPropagation","organizeEventsByWeekday","events","timelineFrom","timelineTo","eventsByWeekday","i","length","Array","isArray","sort","e1","e2","startAt","weekday","endAt","Math","floor","ceil","push","eventsGroupUlHeight","state","prevProps","prevState","error","console","log","code","errorName","name","msg","DeletedUser","warn","isLoadingUserEvents","map","WEEK_DAY","propTypes","object","array","isRequired","func","isUserLoggedIn","bool","mapStateToProps","User","Event"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport PropTypes from \"prop-types\";\nimport { toast } from \"react-toastify\";\nimport Timeline from \"./Timeline.js\";\nimport EventsGroup from \"./EventsGroup.js\";\nimport EventModal from \"./EventModal.js\";\nimport Fab from \"@material-ui/core/Fab\";\nimport AddIcon from \"@material-ui/icons/Add\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\nimport { withStyles } from \"@material-ui/core/styles\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport { logUserOut } from \"../../actions/userActions.js\";\nimport { loadUserEvents, clearError } from \"../../actions/eventActions.js\";\nimport {\n    TIMELINE_UNIT_DURATION,\n    EVENT_SLOT_HEIGHT,\n    DEFAULT_TO,\n    DEFAULT_FROM,\n    WEEK_DAYS,\n    AUTH_ERRORS,\n    EVENT_ERRORS\n} from \"../../constants\";\n\nimport \"../../styles/Schedule.css\";\n\n// styled material ui tooltip and fab\nconst StyledTooltip = withStyles({\n    tooltip: { fontSize: 13 }\n})(Tooltip);\n\nconst StyledFab = withStyles({\n    root: {\n        position: \"fixed\",\n        right: \"40px\",\n        bottom: \"35px\",\n        zIndex: 2,\n        width: \"70px\",\n        height: \"70px\"\n    }\n})(Fab);\n\nclass Schedule extends Component {\n    static propTypes = {\n        error: PropTypes.object,\n        events: PropTypes.array.isRequired,\n        logUserOut: PropTypes.func.isRequired,\n        clearError: PropTypes.func.isRequired,\n        loadUserEvents: PropTypes.func.isRequired,\n        isUserLoggedIn: PropTypes.bool.isRequired,\n        isLoadingUserEvents: PropTypes.bool.isRequired\n    };\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            isModalOpen: false,\n            isEditMode: false,\n            eventToShowInModal: null,\n            ...this.organizeEventsByWeekday(props.events)\n        };\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        if (prevProps.events !== this.props.events) {\n            // if events array changed, reorganize and set state\n            this.setState(this.organizeEventsByWeekday(this.props.events));\n        }\n        if (this.props.error) {\n            console.log(this.props.error);\n            const { error } = this.props;\n            if (error.code) {\n                // handle http error response\n                const errorName = error.name;\n                if (AUTH_ERRORS[errorName]) {\n                    let msg = \"ðŸ˜… Token expired, pls sign in again\";\n                    // jwt token lost, expired or invalid\n                    if (errorName === AUTH_ERRORS.DeletedUser) {\n                        // user is deleted\n                        msg = \"ðŸ˜… Account deleted, pls sign up\";\n                    }\n                    toast.warn(msg);\n                    // sign out user\n                    this.props.logUserOut();\n                } else if (EVENT_ERRORS[errorName]) {\n                    // event does not exist\n                    toast.warn(\"ðŸ˜… Event not found, reloading events\");\n                    // reload user events\n                    this.props.loadUserEvents();\n                }\n            }\n            // clear error\n            this.props.clearError();\n        }\n    }\n\n    // return a click handler which bind a specific event for <SingleEvent />\n    openModalWithEvent = event => e => {\n        e.preventDefault();\n        this.setState({\n            isModalOpen: true,\n            isEditMode: false,\n            eventToShowInModal: event\n        });\n    };\n\n    setIsEditMode = (isEditMode = false) => {\n        this.setState({ isEditMode });\n    };\n\n    closeModal = event => {\n        if (event) event.preventDefault();\n        this.setState({ isModalOpen: false });\n    };\n\n    addButtonClickHandler = event => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setState({\n            isModalOpen: true,\n            isEditMode: true,\n            eventToShowInModal: null\n        });\n    };\n\n    // Iterate through given events array and organize it to a 2-D array by weekday.\n    // also compute the timeline's from and to\n    organizeEventsByWeekday = events => {\n        let timelineFrom = DEFAULT_FROM,\n            timelineTo = DEFAULT_TO;\n        const eventsByWeekday = [];\n        for (let i = 0; i < WEEK_DAYS.length; i++) {\n            eventsByWeekday[i] = [];\n        }\n        if (Array.isArray(events)) {\n            // sort events by event's startAt\n            events.sort((e1, e2) => e1.startAt - e2.startAt);\n            // loop through events\n            for (let i = 0; i < events.length; i++) {\n                let event = events[i];\n                let { weekday, startAt, endAt } = event;\n                // update timeline from\n                if (startAt < timelineFrom)\n                    timelineFrom =\n                        startAt <= 0\n                            ? 0\n                            : Math.floor(startAt / TIMELINE_UNIT_DURATION) *\n                              TIMELINE_UNIT_DURATION;\n                // update timeline to\n                if (endAt > timelineTo)\n                    timelineTo =\n                        endAt >= 1440\n                            ? 1440\n                            : Math.ceil(endAt / TIMELINE_UNIT_DURATION) *\n                              TIMELINE_UNIT_DURATION;\n                // push event to corresponding weekday events array\n                eventsByWeekday[weekday].push(event);\n            }\n        }\n\n        // compute EventsGroup's events <ul> css height\n        const eventsGroupUlHeight =\n            Math.ceil((timelineTo - timelineFrom) / TIMELINE_UNIT_DURATION) *\n            EVENT_SLOT_HEIGHT;\n\n        return {\n            eventsByWeekday,\n            timelineFrom,\n            timelineTo,\n            eventsGroupUlHeight\n        };\n    };\n\n    render() {\n        const { isLoadingUserEvents } = this.props;\n        const {\n            isEditMode,\n            isModalOpen,\n            eventToShowInModal,\n            eventsByWeekday,\n            timelineFrom,\n            timelineTo,\n            eventsGroupUlHeight\n        } = this.state;\n\n        return (\n            <div className=\"cd-schedule\">\n                {/* Loading spinner, conditional render */\n                isLoadingUserEvents && (\n                    <div className=\"progress-container\">\n                        <CircularProgress color=\"secondary\" />\n                        <div>Loading events...</div>\n                    </div>\n                )}\n                {/* timeline, on the left of events grid */}\n                <Timeline from={timelineFrom} to={timelineTo} />\n                {/* events grid */}\n                <div className=\"events\">\n                    <ul>\n                        {WEEK_DAYS.map((WEEK_DAY, i) => (\n                            <EventsGroup\n                                key={i}\n                                weekday={WEEK_DAY}\n                                events={eventsByWeekday[i]}\n                                timelineFrom={timelineFrom}\n                                ulCSSHeight={eventsGroupUlHeight}\n                                openModalWithEvent={this.openModalWithEvent}\n                            />\n                        ))}\n                    </ul>\n                </div>\n                {/* Add event button, conditional render */\n                !isLoadingUserEvents && (\n                    <StyledTooltip\n                        title=\"Add Event\"\n                        placement=\"top\"\n                        aria-label=\"Add Event\"\n                    >\n                        <StyledFab\n                            color=\"secondary\"\n                            aria-label=\"Add\"\n                            onClick={this.addButtonClickHandler}\n                        >\n                            <AddIcon\n                                style={{ width: \"30px\", height: \"30px\" }}\n                            />\n                        </StyledFab>\n                    </StyledTooltip>\n                )}\n\n                <EventModal\n                    closeModal={this.closeModal}\n                    isEditMode={isEditMode}\n                    isModalOpen={isModalOpen}\n                    eventToShow={eventToShowInModal}\n                    setIsEditMode={this.setIsEditMode}\n                />\n            </div>\n        );\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        isUserLoggedIn: state.User.isUserLoggedIn,\n        isLoadingUserEvents: state.Event.isLoadingUserEvents,\n        events: state.Event.events,\n        error: state.Event.error\n    };\n};\n\nexport default connect(\n    mapStateToProps,\n    { logUserOut, loadUserEvents, clearError }\n)(Schedule);\n"]},"metadata":{},"sourceType":"module"}